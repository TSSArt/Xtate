<scxml xmlns="http://www.w3.org/2005/07/scxml" version="1.0" datamodel="ecmascript" initial="idle">
  <state id="idle">
    <transition event="show" target="dialog" />
  </state>

  <state id="dialog">
    <datamodel>
      <data id="id" />
      <data id="origin" />
      <data id="origintype" />
    </datamodel>

    <transition event="show" target="dialog" />

    <onentry>
      <assign location="id" expr="_event.data.id" />
      <assign location="origin" expr="_event.origin" />
      <assign location="origintype" expr="_event.origintype" />
    </onentry>

    <transition event="cancel" condition="id == _event.data.id" target="idle" />

    <invoke type="browser" srcexpr="_event.data.url">
      <content expr="_event.data.content" />
    </invoke>

    <transition event="done.invoke" target="idle">
      <send typeexpr="origintype" targetexpr="origin" event="captcha.submitted">
        <param name="form" expr="_event.data" />
      </send>
    </transition>

    <transition event="error.invoke" target="idle">
      <send typeexpr="origintype" targetexpr="origin" event="captcha.cancelled" />
    </transition>
  </state>
</scxml>