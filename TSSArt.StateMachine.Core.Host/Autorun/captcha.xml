<scxml xmlns="http://www.w3.org/2005/07/scxml" version="1.0" datamodel="ecmascript" initial="idle">
  <state id="idle">
    <transition event="show" target="dialog" />
  </state>

  <state id="dialog">
    <datamodel>
      <data id="origin" />
      <data id="origintype" />
      <data id="result" />
    </datamodel>

    <transition event="show" target="dialog" />

    <onentry>
      <assign location="origin" expr="_event.origin" />
      <assign location="origintype" expr="_event.origintype" />
    </onentry>

    <transition event="cancel" condition="origin == _event.origin &amp;&amp; origintype == _event.origintype"
                target="idle" />

    <invoke type="browser">
      <param name="source" expr="_event.data.source" />
      <param name="type" expr="_event.data.type" />
      <param name="vars" expr="_event.data" />
      <finalize>
        <assign location="result" expr="_event.data" />
      </finalize>
    </invoke>

    <transition event="browser.submit" target="idle">
      <send typeexpr="origintype" targetexpr="origin" event="captcha.recognition.done" namelist="result" />
    </transition>

    <transition event="browser.cancel" target="idle">
      <send typeexpr="origintype" targetexpr="origin" event="captcha.recognition.cancel" />
    </transition>
  </state>
</scxml>